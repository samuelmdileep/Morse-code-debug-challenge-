<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Completed | Morse Quest</title>
  <link rel="icon" type="image/png" href="hackher 1.png">

  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --purple:#8B6AAF;
      --pink:#D4789C;
      --text:#6A5A7A;
      --border:#DBCDF0;
      --green:#5A8A7A;
    }

    body{
      margin:0;
      font-family:"Space Mono",monospace;
      background:linear-gradient(180deg,#FDFCFA,#FAEDCB,#F2C6DE,#DBCDF0,#C6DEF1);
      color:var(--text);
      overflow-x:hidden;
    }

    .header{ text-align:center; padding:40px 20px 10px; }
    .header img{ height:70px; }

    .box{
      max-width:600px;
      margin:40px auto;
      padding:30px;
      background:rgba(255,255,255,0.7);
      border-radius:16px;
      border:2px solid var(--border);
      text-align:center;
      box-shadow:0 12px 25px rgba(0,0,0,0.06);
    }

    h2{ color:var(--purple); font-size:32px; margin-bottom:10px; }

    .score-box{
      font-size:26px; font-weight:700; color:var(--green);
      margin-top:20px; margin-bottom:10px;
    }

    .note{ margin-top:15px; font-size:17px; line-height:1.5; }

    .btn{
      margin-top:25px; width:100%; padding:14px;
      background:#fff; border:2px solid var(--purple);
      color:var(--purple); font-size:18px; font-weight:700;
      border-radius:12px; cursor:pointer; transition:.2s;
    }
    .btn:hover{ background:var(--purple); color:#fff; }

    .footer{ margin-top:40px; text-align:center; opacity:0.7; }
  </style>
</head>

<body>

<div class="header">
  <img src="hackher 1.png">
</div>

<div class="box">
  <h2>üéâ Congratulations!</h2>
  <p>You have completed all rounds of <strong>Morse Quest</strong>.</p>

  <div class="score-box">
    You got <span id="totalCorrect">--</span> / 4 correct
  </div>

  <p class="note">
    Your responses and completion time have been recorded.
    Winners are based on Score + Speed.
  </p>

  <button class="btn" onclick="window.location.href='https://hackher.ieeemace.org/';">
    ‚Üó Go to HackHER Official Page
  </button>
</div>

<div class="footer">
  ¬© 2025 HackHER | Morse Quest
</div>

<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged } from 
    "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { doc, getDoc, setDoc } from 
    "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  // Prevent back
  history.pushState(null,"",location.href);
  window.addEventListener("popstate",()=>history.pushState(null,"",location.href));

  // Disable refresh
  document.addEventListener("keydown",e=>{
    if(e.key==="F5" || (e.ctrlKey&&e.key==="r")) e.preventDefault();
  });

  /* ---------------- FINAL SCORE EVALUATION ---------------- */
  onAuthStateChanged(auth, async(user)=>{
    if(!user) return;

    const ref = doc(db,"scores",user.uid);
    const snap = await getDoc(ref);
    if(!snap.exists()) return;

    const d = snap.data();

    // ‚≠ê READ EXACT FIELD NAMES FROM FIREBASE
    const userAns = {
      level1: d.level1?.response || "",
      level2: d.level2?.response || "",
      level3: d.level3?.response || "",
      level4: d.level4?.response || ""
    };

    // Correct answers
    const correct = {
      level1: "D",
      level2: "POWER",
      level3: "SHE",
      level4: "DATA"
    };

    let total = 0;

    if(userAns.level1.toUpperCase() === correct.level1) total++;
    if(userAns.level2.toUpperCase() === correct.level2) total++;
    if(userAns.level3.toUpperCase() === correct.level3) total++;
    if(userAns.level4.toUpperCase() === correct.level4) total++;

    // Save final score
    await setDoc(ref,{ finalScore: total, evaluatedAt: Date.now() },{ merge:true });

    document.getElementById("totalCorrect").innerText = total;
  });
</script>

</body>
</html>
