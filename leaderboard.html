<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Leaderboard | Admin</title>  
  <link rel="icon" type="image/png" href="hackher 1.png">


  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --purple:#8B6AAF;
      --pink:#D4789C;
      --text:#6A5A7A;
      --border:#DBCDF0;
      --bg:rgba(255,255,255,0.65);
    }

    body{
      margin:0;
      font-family:"Space Mono",monospace;
      background: linear-gradient(180deg,#FDFCFA,#FAEDCB,#F2C6DE,#DBCDF0,#C6DEF1);
      color:var(--text);
      overflow-x:hidden;
    }

    /* HEADER */
    .hackher-header{
      position:fixed;top:0;left:0;right:0;height:72px;
      padding:0 32px;display:flex;align-items:center;
      justify-content:space-between;
      background:rgba(253,252,250,.9);
      backdrop-filter:blur(12px);
      border-bottom:2px solid var(--border);
      z-index:100;
    }
    .nav-left img{height:48px}

    main{
      max-width:900px;margin:0 auto;padding:120px 20px;
    }

    h2{
      text-align:center;
      color:var(--purple);
      font-size:32px;
      margin-bottom:30px;
      font-weight:700;
    }

    .table-box{
      background:var(--bg);
      border:1px solid var(--border);
      border-radius:14px;
      padding:20px;
      box-shadow:0 10px 20px rgba(0,0,0,0.05);
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:16px;
    }

    th,td{
      padding:12px;
      border-bottom:1px solid #c9bfe8;
      text-align:left;
    }

    th{
      color:var(--purple);
      font-weight:700;
    }

    .add-btn{
      padding:6px 14px;
      border-radius:8px;
      border:2px solid var(--purple);
      background:#fff;
      cursor:pointer;
      color:var(--purple);
      font-weight:700;
      transition:.2s;
    }

    .add-btn:hover{
      background:var(--purple);
      color:#fff;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="hackher-header">
    <div class="nav-left">
      <img src="../hackher 1.png" alt="HackHER">
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <h2>$ Leaderboard (Admin Only)</h2>

    <div class="table-box">
      <table id="leaderboardTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>Points</th>
            <th>+</th>
          </tr>
        </thead>
        <tbody id="leaderboardBody">
          <!-- Data loads from Firestore -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- FIREBASE -->
  <script type="module">
    import { auth, db } from "../firebase.js";
    import { onAuthStateChanged } from 
      "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

    import { collection, getDocs, updateDoc, doc, orderBy, query } from 
      "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    // PROTECT ADMIN PAGE
    onAuthStateChanged(auth, user => {
      if(!user){
        window.location.href = "../login.html";
      }
    });

    // LOAD LEADERBOARD
    async function loadLeaderboard(){
      const ref = collection(db, "scores");
      const q = query(ref, orderBy("points", "desc"));
      const snapshot = await getDocs(q);

      const tbody = document.getElementById("leaderboardBody");
      tbody.innerHTML = "";
      
      let rank = 1;
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${rank++}</td>
          <td>${data.name}</td>
          <td>${data.points}</td>
          <td><button class="add-btn" data-id="${docSnap.id}">+10</button></td>
        `;

        tbody.appendChild(tr);
      });

      attachAddPointHandlers();
    }

    // ADD POINTS
    function attachAddPointHandlers(){
      document.querySelectorAll(".add-btn").forEach(btn => {
        btn.onclick = async () => {
          const id = btn.getAttribute("data-id");
          const ref = doc(db, "scores", id);

          // Fetch current score
          const snap = await getDocs(collection(db, "scores"));
          let current = 0;
          snap.forEach(s => {
            if(s.id === id) current = s.data().points;
          });

          await updateDoc(ref, { points: current + 10 });
          loadLeaderboard();
        }
      });
    }

    loadLeaderboard();
  </script>

</body>
</html>
