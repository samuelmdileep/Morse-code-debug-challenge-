<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login | Morse Quest</title>
  <link rel="icon" type="image/png" href="hackher 1.png">


  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --purple:#8B6AAF;
      --pink:#D4789C;
      --text:#6A5A7A;
      --border:#DBCDF0;
      --green:#5A8A7A;
      --bg1:#FDFCFA; --bg2:#FAEDCB; --bg3:#F2C6DE; --bg4:#DBCDF0; --bg5:#C6DEF1;
    }

    body{
      margin:0;
      font-family:"Space Mono",monospace;
      background:linear-gradient(180deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4),var(--bg5));
      color:var(--text);
      overflow-x:hidden;
    }

    /* HEADER */
    .hackher-header{
      position:fixed;top:0;left:0;right:0;height:72px;
      padding:0 32px;display:flex;align-items:center;
      justify-content:space-between;
      background:rgba(253,252,250,.9);backdrop-filter:blur(12px);
      border-bottom:2px solid var(--border);z-index:100;
    }

    .nav-left img{height:48px}

    /* MAIN LOGIN */
    main{
      max-width:500px;margin:0 auto;padding:120px 20px;text-align:center;
    }

    .login-box{
      padding:30px;
      background:rgba(255,255,255,0.65);
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow:0 10px 25px rgba(0,0,0,0.05);
    }

    .google-btn, .admin-toggle, .profile-btn{
      width:100%;
      padding:12px 20px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      transition:.2s ease;
      font-size:16px;
      margin-top:14px;
    }

    .google-btn{
      background:#fff;
      border:2px solid var(--purple);
      color:var(--purple);
    }
    .google-btn:hover{background:var(--purple);color:#fff;}

    .admin-toggle{
      background:#fff;
      border:2px solid var(--purple);
      color:var(--purple);
    }
    .admin-toggle:hover{background:var(--purple);color:#fff;}

    /* ADMIN PANEL */
    .admin-box{
      margin-top:20px;
      display:none;
      flex-direction:column;
      gap:10px;
    }

    .input-box{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid #bdaede;
      font-family:inherit;
    }

    /* PROFILE FORM */
    #profileForm{
      margin-top:20px;
      padding:20px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.85);
      display:none;
      text-align:left;
    }

    #profileForm h3{
      text-align:center;
      color:var(--purple);
      font-weight:700;
      margin-bottom:14px;
    }

    .save-btn{
      width:100%;
      padding:12px;
      border:2px solid var(--green);
      background:#fff;
      color:var(--green);
      font-weight:700;
      border-radius:10px;
      margin-top:14px;
      cursor:pointer;
    }

    .save-btn:hover{
      background:var(--green);
      color:#fff;
    }

    .switch-btn{
      width:100%;
      padding:12px;
      border:2px solid var(--pink);
      background:#fff;
      color:var(--pink);
      font-weight:700;
      border-radius:10px;
      margin-top:10px;
      cursor:pointer;
    }
    .switch-btn:hover{background:var(--pink);color:#fff;}
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="hackher-header">
    <div class="nav-left">
      <img src="hackher 1.png" alt="HackHER Logo">
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <div class="login-box">

      <h2>$ login required</h2>
      <p>Sign in with Google to continue your mission.</p>

      <button id="googleLogin" class="google-btn">
        → Sign in with Google
      </button>

      <button id="showAdmin" class="admin-toggle">
        I am an admin →
      </button>

      <!-- ADMIN PANEL -->
      <div id="adminPanel" class="admin-box">
        <input type="email" id="adminEmail" class="input-box" placeholder="Admin Email">
        <input type="password" id="adminPassword" class="input-box" placeholder="Password">
        <button id="adminLoginBtn" class="google-btn">→ Admin Login</button>
      </div>

      <!-- FIRST-TIME PROFILE FORM -->
      <div id="profileForm">
        <h3>$ Complete Your Profile</h3>

        <input id="pName"     type="text" class="input-box" placeholder="Name">
        <input id="pClass"    type="text" class="input-box" placeholder="Class">
        <input id="pCollege"  type="text" class="input-box" placeholder="College">
        <input id="pPhone"    type="tel"  class="input-box" placeholder="WhatsApp Number">

        <button id="saveProfile" class="save-btn">Save →</button>
        <button id="switchAcc" class="switch-btn">Switch Account</button>
      </div>

    </div>
  </main>

  <script type="module">
  import { auth, provider, db } from "./firebase.js";
  import { signInWithPopup, signInWithEmailAndPassword } from 
    "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { onAuthStateChanged } from 
    "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { doc, getDoc } from 
    "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  // AUTO-REDIRECT IF ALREADY LOGGED IN
  onAuthStateChanged(auth, async (user) => {
    if (!user) return;

    const providerId = user.providerData[0].providerId;

    if (providerId === "password") {
      window.location.href = "leaderboard.html";
      return;
    }

    const snap = await getDoc(doc(db, "users", user.uid));

    if (!snap.exists()) {
      window.location.href = "profile.html";
    } else {
      window.location.href = "rules.html";
    }
  });

  // GOOGLE LOGIN
  googleLogin.onclick = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const uid = result.user.uid;

      const snap = await getDoc(doc(db, "users", uid));

      if (!snap.exists()) {
        window.location.href = "profile.html";
      } else {
        window.location.href = "rules.html";
      }

    } catch (err) {
      alert(err.message);
    }
  };

  // SHOW ADMIN LOGIN
  showAdmin.onclick = () => {
    adminPanel.style.display = adminPanel.style.display === "flex" ? "none" : "flex";
  };

  // ADMIN LOGIN
  adminLoginBtn.onclick = async () => {
    try {
      await signInWithEmailAndPassword(auth, adminEmail.value, adminPassword.value);
      window.location.href = "admin/leaderboard.html";
    } catch (err) {
      alert("Admin login failed: " + err.message);
    }
  };
</script>

</body>
</html>

