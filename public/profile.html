<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Profile | Morse Quest</title>
  <link rel="icon" type="image/png" href="hackher 1.png">


  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --purple:#8B6AAF;
      --pink:#D4789C;
      --green:#5A8A7A;
      --text:#6A5A7A;
      --border:#DBCDF0;
      --bg1:#FDFCFA; --bg2:#FAEDCB; --bg3:#F2C6DE; --bg4:#DBCDF0; --bg5:#C6DEF1;
    }

    body{
      margin:0;
      font-family:"Space Mono",monospace;
      background:linear-gradient(180deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4),var(--bg5));
      color:var(--text);
      overflow-x:hidden;
    }

    /* HEADER */
    .hackher-header{
      position:fixed;top:0;left:0;right:0;height:72px;
      padding:0 32px;display:flex;align-items:center;
      justify-content:space-between;
      background:rgba(253,252,250,.9);backdrop-filter:blur(12px);
      border-bottom:2px solid var(--border);z-index:100;
    }
    .nav-left img{height:48px}

    /* MAIN CONTAINER */
    main{
      max-width:600px;
      margin:0 auto;
      padding:120px 20px;
      text-align:center;
    }

    .profile-box{
      padding:30px;
      background:rgba(255,255,255,0.70);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 12px 35px rgba(0,0,0,0.06);
    }

    .profile-box h2{
      color:var(--purple);
      font-weight:700;
      margin-bottom:24px;
    }

    .input-box{
      width:100%;
      padding:14px;
      border-radius:10px;
      border:1px solid #c7b7df;
      font-family:inherit;
      margin-bottom:18px;
      font-size:15px;
    }

    .save-btn{
      width:100%;
      padding:14px;
      border-radius:10px;
      border:2px solid var(--green);
      background:#fff;color:var(--green);
      font-weight:700;
      cursor:pointer;font-size:16px;
      transition:0.2s;
    }
    .save-btn:hover{
      background:var(--green);
      color:white;
    }

    .logout-btn{
      margin-top:20px;
      width:100%;
      padding:14px;
      border-radius:10px;
      border:2px solid var(--pink);
      background:#fff;color:var(--pink);
      font-weight:700;
      cursor:pointer;
      transition:0.2s;
    }
    .logout-btn:hover{
      background:var(--pink);
      color:#fff;
    }

    .begin-btn{
      width:100%;
      padding:14px;
      border-radius:10px;
      border:2px solid var(--purple);
      background:#fff;color:var(--purple);
      font-weight:700;
      cursor:pointer;
      transition:.2s;
      margin-top:20px;
      display:none;
    }
    .begin-btn:hover{
      background:var(--purple);
      color:#fff;
    }

  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="hackher-header">
    <div class="nav-left">
      <img src="hackher 1.png" alt="HackHER">
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <div class="profile-box">

      <h2>$ edit_profile</h2>
      <p>Update your details for the event.</p>

      <input type="text" id="pName" class="input-box" placeholder="Your Name">
      <input type="text" id="pYear" class="input-box" placeholder="Year">
      <input type="text" id="pDepartment" class="input-box" placeholder="Department">
      <input type="text" id="pCollege" class="input-box" placeholder="College">
      <input type="tel" id="pPhone" class="input-box" placeholder="WhatsApp Number">

      <button id="saveBtn" class="save-btn">Save Changes →</button>
      <button id="beginBtn" class="begin-btn">Begin Game →</button>
      <button id="logoutBtn" class="logout-btn">Logout</button>

    </div>
  </main>

  <!-- FIREBASE -->
  <script type="module">

    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged, signOut } from 
      "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { doc, getDoc, setDoc } from 
      "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const pName = document.getElementById("pName");
    const pYear = document.getElementById("pYear");
    const pDepartment = document.getElementById("pDepartment");
    const pCollege = document.getElementById("pCollege");
    const pPhone = document.getElementById("pPhone");
    const beginBtn = document.getElementById("beginBtn");

    // PROTECT PAGE + LOAD DATA
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);

      if (snap.exists()) {
        const d = snap.data();
        pName.value = d.name || "";
        pYear.value = d.year || "";
        pDepartment.value = d.department || "";
        pCollege.value = d.college || "";
        pPhone.value = d.phone || "";

        beginBtn.style.display = "block"; // show if already filled earlier
      }
    });

    // SAVE PROFILE
    saveBtn.onclick = async () => {
      const user = auth.currentUser;
      if (!user) return;

      if (!pName.value || !pYear.value || !pDepartment.value || !pCollege.value || !pPhone.value) {
        alert("Please fill all fields.");
        return;
      }

      await setDoc(doc(db, "users", user.uid), {
        name: pName.value.trim(),
        year: pYear.value.trim(),
        department: pDepartment.value.trim(),
        college: pCollege.value.trim(),
        phone: pPhone.value.trim(),
        email: user.email
      }, { merge: true });

      alert("Profile updated!");
      beginBtn.style.display = "block";
    };

    // BEGIN GAME
    beginBtn.onclick = () => {
      window.location.href = "rules.html";
    };

    // LOGOUT
    logoutBtn.onclick = async () => {
      await signOut(auth);
      window.location.href = "login.html";
    };

  </script>

</body>

</html>

